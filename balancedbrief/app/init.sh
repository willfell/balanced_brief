#!/bin/sh

# Ensure that the DB is stopped no matter what
trap 'python3 /app/db/instance_state/stop.py' EXIT

set -e

echo "======================================================================================"
echo "======================================================================================"
echo "Start DB"
echo "======================================================================================"
echo "======================================================================================"
python3 /app/db/instance_state/start.py


echo "======================================================================================"
echo "======================================================================================"
echo "Running Migrations"
echo "======================================================================================"
echo "======================================================================================"
python3 /app/db/migrate.py

echo "======================================================================================"
echo "======================================================================================"
echo "Running Article Scraping" 
echo "======================================================================================"
echo "======================================================================================"
python3 /app/article_scraping/scraping.py

echo "======================================================================================"
echo "======================================================================================"
echo "Creating Email Templates and Sending" 
echo "======================================================================================"
echo "======================================================================================"
python3 /app/newsletter/create_email_template.py

